<!-- Banner -->

<div class="banner d-flex flex-column justify-content-between"

style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)),
                          <% if @campaign.photo.attached? %>
                            url('<%= cl_image_path @campaign.photo.key, height: 500, crop: :fill %>')"
                          <% else %>
                            url('https://images.unsplash.com/photo-1536939459926-301728717817?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80')"
                          <% end %>>
  <div class="container">
    <!-- add if statement depending on sorter or recycler -->
    <h4><%= link_to missions_path, class: "position-absolute" do %>
      <i class="fas fa-arrow-left"></i>
      <% end %>
    </h4>
  </div>

  <div class="container">
    <div class="d-flex flex-column align-items-center">
      <% if @campaign.organisation.photo.attached? %>
        <%= cl_image_tag @campaign.organisation.photo.key, width: 56, height: 56, crop: :fill, class: "avatar-large mb-2 plastroc-light-shadow"%>
      <% else %>
        <img style='height: 56px; width: 56px', class='avatar-large mb-2 plastroc-light-shadow' src="https://images.unsplash.com/photo-1536939459926-301728717817?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80" alt="">
      <% end %>
      <h5 class="mb-0"><%= @campaign.name %></h5>
      <h6>by <%= @campaign.organisation.name %></h6>
    </div>
  </div>
</div>

<!-- Tabs -->

<nav class="nav plastroc-tabs d-flex justify-content-around flex-nowrap py-3">
  <a class="active" href="#tab-dashboard" data-toggle="tab">Dashboard</a>
  <a class="" href="#tab-mission-details" data-toggle="tab">Campagne</a>
  <a class="" href="#tab-about-me" data-toggle="tab">Infos</a>
</nav>

<!-- Tabs-content -->

<div class="tab-content position-relative" style="margin-bottom: 75px;">

  <!-- Dashboard-Tab -->

  <div class="tab-pane active" id="tab-dashboard">
    <div class="container">
      <div class="d-flex align-items-center">
        <h5 class="mt-2 mr-2">Progression</h5>
        <% if @campaign.status == "ongoing" %>
          <span class="text-decoration-none badge badge-primary badge-pill mb-0"><%= "#{@campaign.status}" %></span>
        <% else %>
          <span class="text-decoration-none badge badge-dark badge-pill mb-0"><%= "#{@campaign.status}" %></span>
        <% end %>
      </div>
        <div class="d-flex justify-content-between align-items-center">
            <p class="mb-0"><strong>ComplÃ©tÃ©</strong></p>
            <p class="mb-0"><%= @volume_done %>/<%= @campaign.target %><%= @campaign.unit %></p>
        </div>
         <div class="plastroc-progress-bar mt-2 mb-4">
            <div class="rounded-pill plastroc-bg-primary-gradient" id="myBar">0%</div>
         </div>

        <div class="card">
           <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                  <p class="mb-0"><strong>EngagÃ©</strong></p>
                  <p class="mb-0"><%= @volume_total %>/<%= @campaign.target %><%= @campaign.unit %></p>
              </div>
           </div>
        </div>
        <!-- cf new show for dynamic progress bar -->
        <div class="plastroc-progress-bar mt-2 mb-4">
          <div class="rounded-pill plastroc-bg-primary-gradient"></div>
        </div>


      <h5 id="question_title">Questions</h5>
      <% if @campaign.questions.empty? %>
      <p>Pas encore de questions ðŸ˜…</p>
      <% else %>
      <% @campaign.questions.reverse.each do |question|%>
          <blockquote class="blockquote card mt-3">
             <div class="card-body">
                <div class="col-11">
                  <h6 class="mb-0"><%= question.title %></h6>
                  <p class="mb-0"><%= question.content %></p>
                  <footer class="blockquote-footer mt-2 mb-0"><%= question.created_at.strftime("le %m/%d/%Y") %><cite title="Source Title"> par <%= question.user.first_name %></cite></footer>
                </div>
                <div class="col-12 mt-3">
                  <% if question.answer %>
                    <p class="text-right p-0 m-0">
                      <a class="btn btn-sm btn-link-secondary rounded-pill " data-toggle="collapse" href="#question-<%= question.id %>" role="button" aria-expanded="false" aria-controls="collapseExample">ðŸ“£ RÃ©pondu <%= question.updated_at.strftime("le %m/%d/%Y") %> <i class="fas fa-chevron-down"></i></a>
                    </p>
                     <div class="collapse" id="question-<%= question.id %>">
                        <blockquote class="blockquote">
                          <p class="mb-0 mt-2 text-right"><%= question.answer %></p>
                          <footer class="blockquote-footer mt-2 mb-0 text-right"><%= question.campaign.organisation.user.first_name %> de <%= question.campaign.organisation.name %></footer>
                          <div class='d-flex justify-content-end mt-1'>
                            <button href="#" class='mr-2 btn btn-outline-primary rounded-pill d-block plastroc-outline-button' data-toggle="modal" data-target="#answer-<%= question.id %>">
                              modifier
                            </button>
                            <%= link_to 'supprimer', question_path(question), method: :delete, class: 'btn btn-outline-danger rounded-pill d-block plastroc-outline-button'  %>
                          </div>
                     </div>
                  <% else %>
                    <div class='d-flex justify-content-end'>
                      <%= link_to question_path(question), method: :delete, class: 'btn btn-outline-danger rounded-pill d-block plastroc-outline-button mr-3' do %>
                        <i class="fas fa-trash-alt"></i>
                      <% end %>
                      <button href="#" class='btn btn-primary flex-grow-1 rounded-pill plastroc-button' data-toggle="modal" data-target="#answer-<%= question.id %>">
                        RÃ©pondre <i class="pl-2 fas fa-reply"></i>
                      </button>
                    </div>
                   <% end %>
                </div>
             </div>
          </blockquote>
          <!-- Question Edit Modal to give answer-->
          <div class="modal fade" id="answer-<%= question.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">RÃ©pondre Ã  la question</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <%= simple_form_for(question, remote: true) do |f| %>
                    <%= f.input :answer,
                            label: false,
                            placeholder: "RÃ©ponse*",
                            input_html: { class: "col-12 mb-3 h100" } %>
                        <%#= f.submit 'envoyer', class: "btn btn-primary rounded-pill plastroc-button" do %>
                          <!-- <i class="fas fa-paper-plane"></i> -->
                        <%# end %>
                        <%= button_tag type: 'submit', class: "btn col-12 btn-primary rounded-pill plastroc-button" do %>
                          <i class="fas fa-paper-plane"></i>
                        <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
          <!-- End of Question Edit Modal to give answer-->
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Mission-details-Tab -->

  <div class="tab-pane" id="tab-mission-details">
    <div class="container">

      <%= render 'shared/info_content' %>

      <h5>Tuto</h5>

      <%= render 'shared/how_to_content' %>

    </div>
  </div>

  <!-- About-me-Tab -->

  <div class="tab-pane" id="tab-about-me">
    <div class="container">

      <%= render 'shared/contact_content' %>

    <% if current_user != @campaign.user %>
      <button href="#" class='btn btn-outline-primary rounded-pill d-block mt-3 plastroc-outline-button w-100'>
        Poser une question
      </button>
    <% end %>

    </div>
  </div>

<!-- Edit & stop buttons -->

  <div class="bottom-nav">
      <div class="d-flex justify-content-around">
          <p><a href="#" style="color: &plastroc-main;" data-toggle="modal" data-target="#editModal">Editer</a></p>
          <% if @campaign.status == "ongoing" %>
            <p><%= link_to "Stopper", publish_campaign_path(@campaign), method: :patch, style: "color: red", remote: true %></p>
          <% else %>
            <p><%= link_to "Reprendre", publish_campaign_path(@campaign), method: :patch, remote: true %></p>
          <% end %>
      </div>
  </div>

</div>

<!-- Modal Edit  -->

<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Editer la campagne</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container" style="margin-bottom: 75px;">
          <div id="materials" data-materials="<%= @materials.to_json %>"></div>
          <%= simple_form_for @campaign do |f| %>
            <%= f.input :name,
                        label: "Nom",
                        placeholder: "Nom*",
                        input_html: { class: "col-12 mb-3" } %>

            <%= f.input :description,
                        label: "Description",
                        placeholder: "Description*",
                        input_html: { class: "col-12 mb-3" } %>

            <%= f.input :end_date,
                        as: :string,
                        required: false,
                        input_html: { class: "date-picker col-12 mb-3" } %>

            <%= f.input :target,
                        label: "QuantitÃ© totale",
                        placeholder: "QuantitÃ© totale*",
                        input_html: { class: "input col-12 mb-3" } %>

            <%= f.input :min_package,
                        label: "QuantitÃ© minimum par mission",
                        placeholder: "QuantitÃ© minimum par mission*",
                        input_html: { class: "col-12 mb-3" } %>

            <%= f.input :unit,
                        label: false,
                        as: :radio_buttons,
                        collection: Campaign::UNITS,
                        boolean_style: :inline,
                        collection_wrapper_tag: 'div',
                        collection_wrapper_class: 'unit-wrapper',
                        item_wrapper_class: 'unit-item',
                        input_html: {class: 'unit-selector'} %>

            <%= f.input :min_package,
                        label: "QuantitÃ© minimum par mission",
                        placeholder: "QuantitÃ© minimum par mission*",
                        input_html: { class: "col-12 mb-3" } %>

            <%= f.input :photo,
                        as: :file,
                        input_html: { class: "input col-12 mb-3" } %>

            <%= f.submit 'Valider', class: "btn btn-primary rounded-pill d-block plastroc-button plastroc-light-shadow col-12 mb-3" %>
          <% end %>
          <%= link_to 'Annuler', dashboard_campaign_path(@campaign), class: "btn btn-outline-danger rounded-pill d-block mt-3 plastroc-outline-button" %>
        </div>
      </div>
    </div>
  </div>
</div>
